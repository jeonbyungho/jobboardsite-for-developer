<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BusinessMemberMapper">
    <resultMap id="bizMemberResult" type="BusinessMember">
        <result column="business_registration_number" property="bizRegistrationNo"/>
        <result column="company_name" property="companyName"/>
        <result column="ceo_name" property="ceoName"/>
        <association column="id" property="member" javaType="Member">
            <id column="id" property="id"/>
            <result column="username" 	property="username"/>
            <result column="password"	property="password"/>
            <result column="email"		property="email"/>
            <result column="created_at"	property="createdAt" typeHandler="org.apache.ibatis.type.LocalDateTimeTypeHandler"/>
        </association>
    </resultMap>

    <!-- 회원 가입 -->
    <insert id="signUp" parameterType="BusinessMember">
        <selectKey keyProperty="member.id" resultType="long" order="BEFORE">
            SELECT member_seq.nextval FROM dual
        </selectKey>
        BEGIN
            INSERT INTO member (
                id,
                username,
                password,
                email
            ) VALUES (
                #{member.id},
                #{member.username},
                #{member.password},
                #{member.email}
            );
            INSERT INTO business_member (
                member_id,
                business_registration_number,
                company_type,
                company_name,
                ceo_name
            ) VALUES (
                #{member.id},
                #{bizRegistrationNo},
                1,
                #{companyName},
                #{ceoName}
            );
        END;
    </insert>

    <!-- 로그인 -->
    <select id="signIn" parameterType="map" resultMap="bizMemberResult">
        SELECT
            m.id,
            m.username,
            m.password,
            m.email,
            m.created_at,
            biz.business_registration_number,
            biz.company_name,
            biz.ceo_name
        FROM
            business_member biz
            INNER JOIN member m
            ON biz.member_id = m.id
    </select>
</mapper>